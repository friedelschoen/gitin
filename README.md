# `gitin` - Static Git Page Generator

`gitin` generates static HTML pages for a git repository.

## Usage

### `gitin`

`gitin` is used to generate static pages for a git repository.

```bash
gitin [-fhsuvV] [-C workdir] [-d destdir] repos...
gitin [-fhsuvV] [-C workdir] [-d destdir] -r [startdir]
```

| Option     | Description                                                                                                    |
| ---------- | -------------------------------------------------------------------------------------------------------------- |
| -C workdir | Change to the specified working directory before operating. All other arguments must be relative to `workdir`. |
| -d destdir | Specify the destination directory. If the destination does not exist, it will be created.                      |
| -f         | Force rewriting of data, even if it is up-to-date.                                                             |
| -h         | Display the help message and exit.                                                                             |
| -s         | Columnate output, useful for scripts.                                                                          |
| -u         | Only update repositories without writing the index.                                                            |
| -V         | Print the version and exit.                                                                                    |
| -v         | Print a list of all written files.                                                                             |

### `findrepos`

`findrepos` searches for git repositories, useful for scripts or automation.

```bash
findrepos [startdir]
```

## Dependencies

- [GNU Make](https://www.gnu.org/software/make/) - current build system
- [C compiler](https://gcc.gnu.org/) - compiling code
- [pkg-config](https://www.freedesktop.org/wiki/Software/pkg-config/) - getting requirements of libraries
- [libgit2](https://libgit2.org/) - git support
- [libarchive](https://libarchive.org/) - archive support
- [chroma](https://github.com/alecthomas/chroma) - highlight support

## Build

To build and install:

```
$ make
# make install
```

## Documentation

For detailed usage, see the man pages: `gitin(1)` and `findrepos(1)`.

## Configuration

`gitin` uses a simple key-value configuration per directory. 

In the root of you repositories, you can configure the generation. Following options are available:

| **Option**     | **Description**                                                                                      | **Default Value**                         |
| -------------- | ---------------------------------------------------------------------------------------------------- | ----------------------------------------- |
| `name`         | The title of the site, displayed in the HTML header or as the page title.                            | `My Repositories`                         |
| `description`  | A short description of the site.                                                                     | `<empty>`                                 |
| `footertext`   | Footer text that appears at the bottom of every generated HTML page.                                 | `Generated by <i><code>gitin</code></i>!` |
| `favicon`      | Path to the favicon file, which is used in the HTML output.                                          | `favicon.svg`                             |
| `favicontype`  | MIME type of the favicon file, indicating it's an SVG image.                                         | `image/svg+xml`                           |
| `logoicon`     | Path to the logo icon file, used in the header of the HTML page.                                     | `logo.svg`                                |
| `stylesheet`   | Path to the stylesheet (CSS file) used for styling the generated HTML.                               | `style.css`                               |
| `highlightcmd` | Command for syntax highlighting in the HTML output. The color scheme is substituted in this command. | `chroma ...`                              |
| `colorscheme`  | Color scheme for syntax highlighting in the HTML output.                                             | `pastie`                                  |

Repositories have following options:

| **Option**          | **Description**                                                               | **Default Value** |
| ------------------- | ----------------------------------------------------------------------------- | ----------------- |
| `description`       | A short description of the repository.                                        | `<empty>`         |
| `url` or `cloneurl` | URL to clone the repository. Will be shown in the header as `git clone <url>` | `<empty>`         |

Categories have following options:

| **Option**    | **Description**                  | **Default Value** |
| ------------- | -------------------------------- | ----------------- |
| `description` | A short description of the site. | `<empty>`         |


## Automatically Update Files on Git Push

You can automatically update the static files when pushing to a repository using a `post-receive` hook. Be aware that `git push -f` (force push) may alter the commit history, requiring a rebuild of the static pages. `gitin` only checks if the head commit has changed, so history rewrites need to be manually handled. See `gitin(1)` for more details.

Example `post-receive` hook (`repo/.git/hooks/post-receive`):

```bash
#!/bin/sh

# Detect git push -f
gitin_opt=
while read -r old new ref; do
  hasrevs=$(git rev-list "$old" "^$new" | sed 1q)
  if [ -n "$hasrevs" ]; then
    gitin_opt="$gitin_opt -f"
    break
  fi
done

gitin $gitin_opt -r .
```

## Features

- Indexes all repositories in a remote.
- Repositories can be categorized.
- Displays a log of all commits from `HEAD`.
- Shows log and diffstat for each commit.
- Displays a file tree with syntax-highlighted content.
- Shows references such as local branches and tags.
- Creates archives for each reference.
- Detects README and LICENSE files from `HEAD` and links them as web pages.
- Detects submodules (from `.gitmodules`) and links them as web pages.
- Atom feed of the commit log (`commits.xml`).
- Atom feed of the tags/refs (`tags.xml`).
- Generation of json-data, containing all commits and references (`commits.json`).
- Once pages are generated (which can be relatively slow), serving them is fast, simple, and resource-efficient, requiring only a basic HTTP file server.

## Limitations

- **Not ideal for large repositories** (2000+ commits), as generating diffstats is resource-intensive.
- **Not suitable for repositories with many files**, as directory browsing is not supported yet.
- **Assumes a linear history** from `HEAD`, making it unsuitable for repositories with many branches.

  For large repositories or those with complex histories, consider using `cgit` or modifying `gitin` to run as a CGI program.

- **Initial generation can be slow**, though incremental updates are faster due to caching.
- Does not support some dynamic features of `cgit`, such as:
  - Snapshot tarballs for each commit.
  - File tree per commit.
  - Branch history logs diverging from `HEAD`.

## License

This project is licensed under the MIT License. Contributions are welcome!